import { ArgsTable, Meta, Story, Canvas } from '@storybook/addon-docs/blocks';

import { MessageList } from '.';

import {
  message1001,
  messagePlusAttachments1004,
  messageByBob1002,
  messageTwoByBob1003,
  directMessageChat,
} from '../../../util/mocks';

<Meta title="ChatEngine/ChatFeed/MessageList" component={MessageList} />

export const Template = (args) => <MessageList {...args} />;

# Message List

The message list component displays all the messages sent into a Chat.

## Default

<Story
  name="Default"
  args={{
    messages: {
      '2021-07-14 01:01:00.000000+00:00': message1001,
      '2021-07-14 01:02:00.000000+00:00': messageByBob1002,
      '2021-07-14 01:03:00.000000+00:00': messageTwoByBob1003,
      '2021-07-14 01:04:00.000000+00:00': messagePlusAttachments1004,
    },
    messageListStyle: {
      maxHeight: '450px',
      boxShadow: '0px 0px 3px 6px rgba(0, 0, 0, 0.1)',
      overflowY: 'scroll',
    },
    messageListStyle: {
      maxWidth: '500px',
      boxShadow: '0px 0px 3px 6px rgba(0, 0, 0, 0.1)',
    },
  }}
>
  {Template.bind({})}
</Story>

<ArgsTable story="Default" />

## My Username

You can specify your username with `myUsername` prop. Any Message component where `message.sender_username === myUsername` will appear to be sent by you.

This is done by setting the Message component's `isMyMessage` prop to `true`.

<Canvas>
  <Story
    name="My Username"
    args={{
      messages: {
        '2021-07-14 01:01:00.000000+00:00': message1001,
        '2021-07-14 01:02:00.000000+00:00': messageByBob1002,
        '2021-07-14 01:03:00.000000+00:00': messageTwoByBob1003,
      },
      myUsername: 'bob_baker',
      messageListStyle: {
        maxWidth: '500px',
        boxShadow: '0px 0px 3px 6px rgba(0, 0, 0, 0.1)',
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Chat with Reads

You can pass a `chat` prop which will show Chat Members and their read messages.

<Canvas>
  <Story
    name="Chat with Reads"
    args={{
      messages: {
        '2021-07-14 01:01:00.000000+00:00': message1001,
        '2021-07-14 01:02:00.000000+00:00': messageByBob1002,
        '2021-07-14 01:03:00.000000+00:00': messageTwoByBob1003,
      },
      myUsername: 'bob_baker',
      chat: directMessageChat,
      messageListStyle: {
        maxWidth: '500px',
        boxShadow: '0px 0px 3px 6px rgba(0, 0, 0, 0.1)',
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Date Time

When a message is sent, if the `lastMessage` is `null` or it was created on another day, the `<DateTime/>` component will become visible.

Here is an example of two messages sent on different days, rendering a `<DateTime/>` each.

<Canvas>
  <Story
    name="Date Time"
    args={{
      messages: {
        '2021-07-14 01:01:00.000000+00:00': message1001,
        '2021-07-14 01:02:00.000000+00:00': messageByBob1002,
      },
      messageListStyle: {
        maxWidth: '500px',
        boxShadow: '0px 0px 3px 6px rgba(0, 0, 0, 0.1)',
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Has More Messages

If your Chat room has a longer Message history, you can set `hasMoreMessages` to `true`.

This will put a `<Spinner/>` component at the top of the chat feed which is used to load more messages.

<Canvas>
  <Story
    name="Has More Messages"
    args={{
      messages: {
        '2021-07-14 01:01:00.000000+00:00': message1001,
        '2021-07-14 01:02:00.000000+00:00': messageByBob1002,
      },
      hasMoreMessages: true,
      messageListStyle: {
        maxWidth: '500px',
        boxShadow: '0px 0px 3px 6px rgba(0, 0, 0, 0.1)',
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Render Triggers

When the top and bottom message become visible, you can trigger custom functions.

Use the `onTopMessageShow`/`onTopMessageHide` and `onBottomMessageShow`/`onBottomMessageHide` functions to trigger functions accordingly.

It's commonly used to know when you need to load more messages, or mark a chat's messages as "all read".

Check the console log for this example.

<Canvas>
  <Story
    name="Render Triggers"
    args={{
      messages: {
        '2021-07-14 01:01:00.000000+00:00': message1001,
        '2021-07-14 01:02:00.000000+00:00': messageByBob1002,
      },
      onTopMessageShow: () => console.log('Top message showing'),
      onTopMessageHide: () => console.log('Top message hidden'),
      onBottomMessageShow: () => console.log('Bottom message showing'),
      onBottomMessageHide: () => console.log('Bottom message hidden'),
      messageListStyle: {
        maxWidth: '500px',
        boxShadow: '0px 0px 3px 6px rgba(0, 0, 0, 0.1)',
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Custom Style

You can customize the look and feel with the `customStyle` prop.

<Canvas>
  <Story
    name="Custom Style"
    args={{
      messages: {
        '2021-07-14 01:01:00.000000+00:00': message1001,
        '2021-07-14 01:02:00.000000+00:00': messageByBob1002,
      },
      messageListStyle: {
        maxWidth: '500px',
        boxShadow: '0px 0px 3px 6px rgba(0, 0, 0, 0.1)',
        border: '2px solid red',
      },
      messageStyle: { border: '2px solid blue' },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>
